sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/Label","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageToast"],function(e,t,o,r,n,a,i){"use strict";return e.extend("sierra.pra.PRA_Custom.controller.payout",{onInit:function(){var e=this;this.globalModel=this.getOwnerComponent().getModel("globalModel");var o=new t(this.globalModel);o.setSizeLimit(500);this.getView().setModel(o,"oModel");console.log("omodel first ",o);this.onPayoutadd();jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/typedisplay",dataType:"json",async:false,success:function(t){e.globalModel.PayoutAddPayoutType=t}});jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/statusdisplay",dataType:"json",async:false,success:function(t){e.globalModel.PayoutAddStatus=t}});jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/freqdisplay",dataType:"json",async:false,success:function(t){e.globalModel.PayoutAddFrequency=t}});jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/venturedisplay",dataType:"json",async:false,success:function(o){e.globalModel.PayoutVenture=o;var r=new t(o);r.setSizeLimit(500);e.getView().setModel(r,"oModelPayoutVenture")}});jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/costdisplay",dataType:"json",async:false,success:function(t){e.globalModel.Payoutcostcenteradd=t}})},onSearch:function(e){debugger;var t=e.getParameter("suggestionItem");if(t){i.show("Search for: "+t.getText())}else{i.show("Search is fired!")}},onSuggest:function(e){debugger;this.oSF=this.getView().byId("searchField");var t=e.getParameter("suggestValue"),o=[];if(t){o=[new r([new r("VENTURE_ID",function(e){return(e||"").toUpperCase().indexOf(t.toUpperCase())>-1})],false)]}this.oSF.getBinding("suggestionItems").filter(o);this.oSF.suggest()},onVentureSelect:function(){var e=this;let t=e.getView().byId("searchField").mProperties.value;jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/venturejoin?VENTURE_ID=%27"+t+"%27",dataType:"json",async:false,success:function(t){e.globalModel.PayoutCostcenter=t}})},onPayoutadd:function(){var e=this;jQuery.ajax({type:"GET",contentType:"application/json",url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/postdisplay",dataType:"json",async:false,success:function(o){e.globalModel.PayoutTableData=o;let r=o.data.map(e=>({PAYOUT_ID_List:e.PAYOUT_ID}));let n={ids:r};var a=new t(n);a.setSizeLimit(500);e.getView().setModel(a,"oModelPayoutid");var i=new t(o);i.setSizeLimit(500);e.getView().setModel(i,"oModelPayout");let s=e.globalModel.PayoutTableData.data.reduce((e,t)=>t.PAYOUT_ID>=e.PAYOUT_ID?t:e);let d=Number(s.PAYOUT_ID);e.globalModel.PayoutID=String(d+1).padStart(5,"0")}})},onSavePayoutAdd:function(){debugger;let e={PAYOUT_ID:this.getView().byId("productInputpayout").mProperties.value,VENTURE:this.getView().byId("ventureselect").mProperties.selectedKey,COST_CENTER:this.getView().byId("selectcost").mProperties.selectedKey,STATUS:this.getView().byId("selectstatus").mProperties.selectedKey,PAYOUT_TYPE:this.getView().byId("payouttypeadd").mProperties.selectedKey,REPORTING_FREQUENCY:this.getView().byId("reportingfrequencyadd").mProperties.selectedKey,BEGIN_DATE:this.getView().byId("idIssueDate11").mProperties.value,END_DATE:this.getView().byId("idIssueDate22").mProperties.value};$.ajax({url:"https://56d6569dtrial-dev-orp-srv.cfapps.us10.hana.ondemand.com/postadd",type:"POST",data:e,contentType:"application/x-www-form-urlencoded",success:function(e){console.log("success"+e)},error:function(e){console.log("error: "+e)}});this.getView().getModel("oModel").refresh();this.onPayoutadd();this.byId("payout_add").destroy();this.pErrorLogPopover=undefined},onDisplayForm:function(e){var t=this.getView().getModel("oModel");this.globalModel.navigationMode="Display";var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("Routepayout_position",{},true)},onPressPayoutAdd:function(){var e=this.getView();var t=this;if(!t.pErrorLogPopover){t.pErrorLogPopover=a.load({id:e.getId(),name:"sierra.pra.PRA_Custom.view.payout_add",controller:t}).then(function(t){debugger;e.addDependent(t);return t})}t.pErrorLogPopover.then(function(e){e.open()})},onPayoutBalAdj:function(){var e=this.getView();var t=this;if(!t.pErrorLogPopover){t.pErrorLogPopover=a.load({id:e.getId(),name:"sierra.pra.PRA_Custom.view.payout_baladj",controller:t}).then(function(t){debugger;e.addDependent(t);return t})}t.pErrorLogPopover.then(function(e){e.open()})},onPayoutProvisions:function(){var e=this.getView();var t=this;if(!t.pErrorLogPopover){t.pErrorLogPopover=a.load({id:e.getId(),name:"sierra.pra.PRA_Custom.view.payout_provisions",controller:t}).then(function(t){debugger;e.addDependent(t);return t})}t.pErrorLogPopover.then(function(e){e.open()})},onCloseErrorLogPopover:function(){this.byId("PayoutBalAdjPopover").destroy();this.pErrorLogPopover=undefined;debugger},onSaveBalAdj:function(){},onAddLineItem:function(){var e=0;debugger;this.globalModel.BalAdjLineItem.forEach(t=>{debugger;e+=Number(t.Amount);this.globalModel.BalAdjLineItemTotal=e;debugger});console.log(e);console.log(this.globalModel.BalAdjLineItem);console.log(this.globalModel.BalAdjLineItemTotal);this.getView().getModel("oModel").refresh();var t={FormType:"Bal",FormNum:"Bal_001",GLAccount:"",Description:"",Amount:"",FundApproved:0,readOnly:false};this.globalModel.BalAdjLineItem.push(t);console.log(this.globalModel.BalAdjLineItem);this.getView().getModel("oModel").refresh()},onLiveChge:function(){},onpressCostcenter:function(){var e=this.getView();var t=this;if(!t.pErrorLogPopover){t.pErrorLogPopover=a.load({id:e.getId(),name:"sierra.pra.PRA_Custom.view.payout_costcenter",controller:t}).then(function(t){debugger;e.addDependent(t);return t})}t.pErrorLogPopover.then(function(e){e.open()})},onCloseErrorcost:function(){this.byId("Payoutcostcenter").destroy();this.pErrorLogPopover=undefined;debugger},onClosePayoutAdd:function(){this.byId("payout_add").destroy();this.pErrorLogPopover=undefined;debugger},onExit:function(){this.aKeys=[];this.aFilters=[];this.oModel=null},onToggleHeader:function(){this.getPage().setHeaderExpanded(!this.getPage().getHeaderExpanded())},onToggleFooter:function(){this.getPage().setShowFooter(!this.getPage().getShowFooter())},onSelectChange:function(){var e=[];e.push(this.getSelectedItemText(this.oSelectName));e.push(this.getSelectedItemText(this.oSelectCategory));e.push(this.getSelectedItemText(this.oSelectSupplierName));e.push(this.getSelectedItemText(this.oSelectVenture));e.push(this.getSelectedItemText(this.oSelectWell));this.filterTable(e)},filterTable:function(e){this.getTableItems().filter(this.getFilters(e));this.updateFilterCriterias(this.getFilterCriteria(e))},updateFilterCriterias:function(e){this.removeSnappedLabel();this.addSnappedLabel();this.oModel.setProperty("/Filter/text",this.getFormattedSummaryText(e))},addSnappedLabel:function(){var e=this.getSnappedLabel();e.attachBrowserEvent("click",this.onToggleHeader,this);this.getPageTitle().addSnappedContent(e)},removeSnappedLabel:function(){this.getPageTitle().destroySnappedContent()},getFilters:function(e){this.aFilters=[];this.aFilters=this.aKeys.map(function(t,o){return new r(t,n.Contains,e[o])});return this.aFilters},getFilterCriteria:function(e){return this.aKeys.filter(function(t,o){if(e[o]!==""){return t}})},getFormattedSummaryText:function(e){if(e.length>0){return"Filtered By ("+e.length+"): "+e.join(", ")}else{return"Filtered by None"}},getTable:function(){return this.getView().byId("idProductsTable")},getTableItems:function(){return this.getTable().getBinding("items")},getSelect:function(e){return this.getView().byId(e)},getSelectedItemText:function(e){return e.getSelectedItem()?e.getSelectedItem().getKey():""},getPage:function(){return this.getView().byId("dynamicPageId")},getPageTitle:function(){return this.getPage().getTitle()},getSnappedLabel:function(){return new o({text:"{/Filter/text}"})}})});